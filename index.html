<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Advice-OnlyÂ® Learning Management System (Preview)</title>
  <meta name="robots" content="noindex,nofollow"/>
  <meta name="ao-root" content="/"/>

  <link rel="stylesheet" href="static/css/ao-ui.css"/>
  <script src="https://unpkg.com/survey-core@1.9.162/survey.core.min.js"></script>
  <script src="https://unpkg.com/survey-knockout-ui@1.9.162/survey-knockout-ui.min.js"></script>
  <link href="https://unpkg.com/survey-core@1.9.162/defaultV2.min.css" rel="stylesheet"/>
</head>
<body>
  <!-- header / layout unchanged -->
  <script>
  /* ... analytics + theme scripts ... */

  document.addEventListener('DOMContentLoaded', function () {
    const NAV=document.getElementById('nav'), MAIN=document.getElementById('main'),
          MENU=document.getElementById('menu'), SEARCH_BOX=document.getElementById('q'),
          SEARCH_DD=document.getElementById('dd');

    const LS_SEEN='ao.v2.seen', LS_TIME='ao.v2.time', LS_LAST='ao.v2.last',
          LS_QUIZ='ao.v2.quiz', LS_ASSESS='ao.v2.assess', COMP_THRESH={red:20,yellow:60};

    const params=new URLSearchParams(location.search);
    const WANT_DEMO=params.get('demo')==='1';
    const WANT_FULL=params.get('full')==='1';

    const h=(t,a={},...c)=>{const e=document.createElement(t);
      for(const[k,v]of Object.entries(a)){
        if(k==='class')e.className=v;
        else if(k==='html')e.innerHTML=v;
        else if(k.startsWith('on')&&typeof v==='function')e.addEventListener(k.slice(2),v);
        else e.setAttribute(k,v);
      }
      c.forEach(x=>{if(x!=null)e.appendChild(typeof x==='string'?document.createTextNode(x):x)});
      return e;
    };
    const tokenize=s=>(s||'').toLowerCase().replace(/[^a-z0-9\s]/g,' ').split(/\s+/).filter(Boolean);
    const loadJSON=(k,def)=>{try{return JSON.parse(localStorage.getItem(k)||'')||def;}catch{return def;}};
    const saveJSON=(k,v)=>localStorage.setItem(k,JSON.stringify(v));

    const seen=new Set(loadJSON(LS_SEEN,[]));
    const timeMap=loadJSON(LS_TIME,{});
    const quizResults=loadJSON(LS_QUIZ,{});
    const assessResults=loadJSON(LS_ASSESS,{});
    let currentTimer=null, site=null, chapters=[], docs=[];

    function saveQuizResult(id,payload){quizResults[id]=payload;saveJSON(LS_QUIZ,quizResults);}
    function saveAssessResult(id,payload){assessResults[id]=payload;saveJSON(LS_ASSESS,assessResults);}

    function renderQuiz(lo,key){
      const surveyJson=lo.quiz; if(!surveyJson) return;
      const host=h('div',{class:'cardlet',style:'margin-top:20px;'}); MAIN.appendChild(host);
      Survey.StylesManager.applyTheme('defaultV2');
      const survey=new Survey.Model(surveyJson);
      survey.onComplete.add(sender=>{
        saveQuizResult(lo.quiz.id||`quiz_${key}`,{
          key,score:sender.getCorrectAnswerCount(),total:sender.getQuestionCount(),
          answers:sender.data,ts:Date.now()
        });
      });
      survey.render(host);
    }

    function renderAssessment(ch,chIdx){
      const surveyJson=ch.assessment; if(!surveyJson) return;
      const host=document.getElementById('survey-container'); if(!host) return;
      Survey.StylesManager.applyTheme('defaultV2');
      const survey=new Survey.Model(surveyJson);
      survey.onComplete.add(sender=>{
        saveAssessResult(ch.assessment.id||`assess_ch${chIdx+1}`,{
          chapter:chIdx+1,answers:sender.data,ts:Date.now()
        });
      });
      survey.render(host);
    }

    /* ... rest of existing index.js logic (renderMain, renderMyData, search, boot, etc.) ... */
  });
  </script>
  <!-- privacy popup script unchanged -->
</body>
</html>
