<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Advice Only‚Ñ¢ Bookstore (Preview)</title>
  <meta name="robots" content="noindex,nofollow"/>

  <style>
    :root{
      --bg:#0b0e13; --panel:#10151c; --muted:#9bb0c2; --fg:#e8eef3; --brand:#00d0b6;
      --border:#1e2630; --hover:#131b24; --ok:#123f2c; --okfg:#a8f0c7; --err:#3b2930; --errfg:#f7c0c7
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--fg);font:14px/1.45 system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial,sans-serif}
    a{color:var(--brand);text-decoration:none}
    code,kbd,pre{font:12px/1.4 ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}

    /* Top bar */
    .top{display:flex;gap:10px;align-items:center;padding:10px 14px;border-bottom:1px solid var(--border);background:#0c1117;position:sticky;top:0;z-index:10}
    .brand{display:flex;align-items:center;gap:8px;font-weight:700}
    .brand .logo{width:16px;height:16px;border-radius:4px;background:linear-gradient(135deg,#00d0b6,#1ea8e6)}
    .tabs{display:flex;gap:6px;margin-left:12px}
    .tab{padding:6px 10px;border:1px solid var(--border);border-radius:8px;background:transparent;color:#cfe0ee;cursor:pointer}
    .tab[aria-current="true"]{background:#0f1b22}
    .grow{flex:1}
    .search{display:flex;gap:6px}
    .search input{width:280px;max-width:40vw;border:1px solid var(--border);background:#0e141b;color:var(--fg);padding:6px 8px;border-radius:8px}
    .search button{padding:6px 10px;border:1px solid var(--border);border-radius:8px;background:#14202a;color:#cfe0ee;cursor:pointer}

    /* Shell */
    .wrap{display:grid;grid-template-columns:280px 1fr 320px;gap:14px;min-height:calc(100vh - 52px);padding:14px}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:12px;min-height:120px}
    .nav{padding:10px;overflow:auto}
    .nav h3{margin:12px 8px 8px;color:#bfd2e3;font-size:12px;font-weight:700;letter-spacing:.3px;text-transform:uppercase}
    .nav ul{list-style:none;margin:0;padding:0}
    .nav li{margin:0}
    .nav button{display:block;width:100%;text-align:left;background:transparent;border:0;color:var(--fg);padding:8px 10px;border-radius:8px;cursor:pointer}
    .nav button:hover{background:var(--hover)}
    .nav .lo{padding-left:18px;color:#cfe0ee}
    .nav button[aria-current="true"]{background:#0e2723;outline:1px solid #11433b}
    .nav .lock{opacity:.55}

    .main{padding:16px;overflow:auto}
    .main h1{margin:0 0 14px;font-size:22px}
    .main h2{margin:18px 0 8px;font-size:16px}
    .lead{color:#c7d7e6;margin-bottom:14px}
    .muted{color:var(--muted)}
    .rail{padding:12px}
    .alert{border:1px solid var(--border);padding:12px;border-radius:10px;color:#c7d7e6}
    .hr{border-top:1px solid var(--border);margin:14px 0}

    /* Simple blocks & callouts */
    .callout{border:1px dashed #2b3a4a;padding:10px;border-radius:10px;background:#0f141b;margin:10px 0}
    blockquote{margin:10px 0;padding:10px 12px;border-left:3px solid #2c3c4d;background:#0f141b;border-radius:8px}
    ul,ol{margin:8px 0 12px 18px}
    figure{margin:12px 0}
    figcaption{color:var(--muted);font-size:12px;margin-top:6px}

    /* Empty states */
    .empty{color:#9fb3c6;padding:8px}

    /* Responsive */
    @media (max-width:1100px){.wrap{grid-template-columns:1fr}.rail{order:3}.nav{order:1}.main{order:2}}
  </style>
</head>
<body>

  <!-- Top bar -->
  <header class="top">
    <div class="brand"><div class="logo"></div> Advice Only‚Ñ¢ Bookstore</div>
    <nav class="tabs" id="topTabs">
      <button class="tab" data-view="read" aria-current="true">Read</button>
      <button class="tab" data-view="data">My Data</button>
      <button class="tab" data-view="events">Events</button>
      <button class="tab" data-view="profile">Profile</button>
      <button class="tab" data-view="transparency">Transparency</button>
    </nav>
    <div class="grow"></div>
    <form class="search" id="searchForm" autocomplete="off">
      <input id="searchInput" placeholder="Search snippets, topics‚Ä¶"/>
      <button type="submit">Search</button>
    </form>
  </header>

  <!-- Body -->
  <div class="wrap">
    <aside class="card nav" id="nav"><div class="empty">Loading‚Ä¶</div></aside>

    <main class="card main" id="main">
      <h1>Welcome</h1>
      <p class="lead">Select a learning objective from the left.</p>
      <div class="muted">This page is using an <code>inline JSON</code> bundle embedded in the HTML.</div>
    </main>

    <aside class="card rail" id="rail">
      <h3 style="margin:0 0 10px;color:#bfd2e3;font-size:12px;font-weight:700;letter-spacing:.3px;text-transform:uppercase">Alerts</h3>
      <div class="alert">‚ÄúSite accessibility tutorial‚Äù lives here for now. Later: notifications for subscribed users.</div>
    </aside>
  </div>

  <script>
  (()=>{
    const el = sel => document.querySelector(sel);
    const navEl = el('#nav');
    const mainEl = el('#main');
    const tabsEl = el('#topTabs');
    const searchForm = el('#searchForm');
    const searchInput = el('#searchInput');

    // ---- read inline JSON ----
    let SITE = {};
    try {
      const raw = document.getElementById('SITE_DATA')?.textContent ?? '{}';
      SITE = JSON.parse(raw);
    } catch(e) {
      console.error('Inline JSON parse error:', e);
      SITE = { book:{title:'(invalid inline JSON)'}, chapters:[] };
    }

    // ---- simple router ----
    function setTab(view){
      tabsEl.querySelectorAll('.tab').forEach(b=>b.setAttribute('aria-current', String(b.dataset.view===view)));
      if (view==='read')      renderRead();
      else if (view==='data') renderData();
      else if (view==='events') renderEvents();
      else if (view==='profile') renderProfile();
      else if (view==='transparency') renderTransparency();
      history.replaceState(null,'',location.pathname + location.search + (view==='read' ? location.hash : ''));
    }

    tabsEl.addEventListener('click', e=>{
      const btn = e.target.closest('.tab'); if(!btn) return;
      setTab(btn.dataset.view);
    });

    // ---- nav + main (READ) ----
    function loLabel(lo){
      const t = (lo.title||'').trim();
      const m = t.match(/(\d+\.\d+)/);
      if(m){
        const rest = t.replace(m[0],'').replace(/^[-‚Äî:\s]+/,'').trim();
        return `${m[0]} ‚Äî ${rest||''}`.trim();
      }
      return t||'Untitled';
    }

    function renderNav(chapters){
      navEl.innerHTML = '';
      const ul = document.createElement('ul');
      chapters.forEach((ch,chIdx)=>{
        const h3 = document.createElement('h3');
        h3.textContent = ch.title || `Chapter ${chIdx+1}`;
        ul.appendChild(h3);
        (ch.los||[]).forEach((lo,loIdx)=>{
          const btn = document.createElement('button');
          btn.className = 'lo';
          btn.textContent = loLabel(lo) + (ch.locked ? ' üîí' : '');
          if (ch.locked) btn.classList.add('lock');
          btn.onclick = ()=>{
            if (ch.locked) {
              mainEl.innerHTML = `<h1>${ch.title}</h1><div class="callout">This chapter is available in the full version.</div>`;
              setActive(btn);
              return;
            }
            renderLo(ch, lo);
            location.hash = `#ch${chIdx+1}-lo${loIdx+1}`;
            setActive(btn);
          };
          ul.appendChild(document.createElement('li')).appendChild(btn);
        });
      });
      navEl.appendChild(ul);
    }

    function setActive(btn){
      navEl.querySelectorAll('button[aria-current="true"]').forEach(b=>b.setAttribute('aria-current','false'));
      btn?.setAttribute('aria-current','true');
      btn?.scrollIntoView({block:'nearest'});
    }

    function renderLo(ch, lo){
      mainEl.innerHTML = '';
      const h1 = document.createElement('h1');
      h1.textContent = `${ch.title} ‚Äî ${lo.title}`;
      const p = document.createElement('p'); p.className='lead';
      p.textContent = lo.preview || 'Learning objective.';
      mainEl.append(h1,p);

      // Snippets (title, body, quote, list, image)
      (lo.snippets||[]).forEach(s=>{
        if (s.title) mainEl.appendChild(Object.assign(document.createElement('h2'),{textContent:s.title}));
        if (s.body)  mainEl.appendChild(Object.assign(document.createElement('p'),{textContent:s.body}));
        if (s.quote) {
          const bq = document.createElement('blockquote');
          bq.textContent = s.quote;
          mainEl.appendChild(bq);
        }
        if (Array.isArray(s.bullets) && s.bullets.length){
          const ul = document.createElement('ul');
          s.bullets.forEach(t=>ul.appendChild(Object.assign(document.createElement('li'),{textContent:t})));
          mainEl.appendChild(ul);
        }
        if (s.image && s.image.src){
          const fig = document.createElement('figure');
          const img = Object.assign(document.createElement('img'), {src:s.image.src, alt:s.image.alt||'', style:'max-width:100%;border-radius:8px'});
          fig.appendChild(img);
          if (s.image.caption) fig.appendChild(Object.assign(document.createElement('figcaption'),{textContent:s.image.caption}));
          mainEl.appendChild(fig);
        }
      });
    }

    function openFromHash(){
      const m = location.hash.match(/^#ch(\d+)-lo(\d+)$/);
      const chIndex = m ? (+m[1]-1) : 0;
      const loIndex = m ? (+m[2]-1) : 0;
      const chapters = SITE.chapters || [];
      const ch = chapters[chIndex];
      const lo = ch?.los?.[loIndex];
      if (ch && lo){
        renderLo(ch, lo);
        const btns = [...navEl.querySelectorAll('button.lo')];
        // compute flat index to mark active
        let flat=0,target=0;
        chapters.forEach((c,ci)=> (c.los||[]).forEach((l,li)=>{ if (ci===chIndex && li===loIndex) target=flat; flat++; }));
        setActive(btns[target]);
        return true;
      }
      return false;
    }

    function renderRead(){
      renderNav(SITE.chapters||[]);
      if (!openFromHash()){
        // pick the first non-locked LO
        const chIndex = (SITE.chapters||[]).findIndex(c=>!c.locked && (c.los||[]).length);
        if (chIndex>=0){
          location.hash = `#ch${chIndex+1}-lo1`;
          openFromHash();
        } else {
          mainEl.innerHTML = `<h1>${SITE.book?.title||'Book'}</h1><div class="callout">No readable chapters in this preview.</div>`;
        }
      }
    }

    // ---- other tabs (lightweight stubs) ----
    function renderData(){
      navEl.innerHTML = `<div class="empty">Navigation hidden on this view.</div>`;
      mainEl.innerHTML = `
        <h1>My Data</h1>
        <div class="callout">This is a placeholder panel for progress, saved snippets, and downloads.</div>
        <div class="hr"></div>
        <p class="muted">Coming soon: CSV/PDF export, saved reading position, and private notes.</p>`;
    }

    function renderEvents(){
      navEl.innerHTML = `<div class="empty">Navigation hidden on this view.</div>`;
      mainEl.innerHTML = `
        <h1>Events</h1>
        <div class="callout">Upcoming sessions will appear here.</div>
        <ul>
          <li>Online ‚Äî Platform Walkthrough (Preview), Nov 3, 2025 ¬∑ 4‚Äì5pm PT</li>
          <li>Advisor CE ‚Äî Advice Only in Practice (Online), Oct 1, 2025 ¬∑ 4‚Äì5pm PT</li>
          <li>Advisor CE ‚Äî In Person (San Mateo), Oct 1, 2025 ¬∑ 4‚Äì5pm PT</li>
        </ul>`;
    }

    function renderProfile(){
      navEl.innerHTML = `<div class="empty">Navigation hidden on this view.</div>`;
      mainEl.innerHTML = `
        <h1>Profile</h1>
        <div class="callout">Sign-in and profile integrations can live here (Cloudflare Access + email fallback).</div>
        <p class="muted">For preview, this is static content.</p>`;
    }

    function renderTransparency(){
      navEl.innerHTML = `<div class="empty">Navigation hidden on this view.</div>`;
      mainEl.innerHTML = `
        <h1>Transparency</h1>
        <ul>
          <li>Privacy & Data Use</li>
          <li>Content updates & change log</li>
          <li>Accessibility notes</li>
        </ul>`;
    }

    // ---- search (simple: scans titles + snippet bodies) ----
    searchForm.addEventListener('submit', e=>{
      e.preventDefault();
      const q = (searchInput.value||'').trim().toLowerCase();
      if (!q) return;
      const hits = [];
      (SITE.chapters||[]).forEach((ch,ci)=>{
        (ch.los||[]).forEach((lo,li)=>{
          const hay = [
            lo.title||'',
            lo.preview||'',
            ...(lo.snippets||[]).flatMap(s=>[s.title||'',s.body||'',s.quote||''])
          ].join('\n').toLowerCase();
          if (hay.includes(q)) hits.push({ch,lo,ci,li});
        });
      });
      navEl.innerHTML = `<div class="empty">${hits.length} result(s) for ‚Äú${q}‚Äù</div>`;
      mainEl.innerHTML = `<h1>Search</h1>`;
      if (!hits.length){
        mainEl.innerHTML += `<div class="callout">No matches. Try different keywords.</div>`;
        return;
      }
      const ul = document.createElement('ul');
      hits.slice(0,50).forEach(h=>{
        const li = document.createElement('li');
        const a = document.createElement('a');
        a.href = `#ch${h.ci+1}-lo${h.li+1}`;
        a.textContent = `${h.ch.title} ‚Äî ${h.lo.title}`;
        a.onclick = (ev)=>{
          ev.preventDefault();
          setTab('read');
          location.hash = `#ch${h.ci+1}-lo${h.li+1}`;
          openFromHash();
        };
        li.appendChild(a);
        ul.appendChild(li);
      });
      mainEl.appendChild(ul);
    });

    // ---- init ----
    setTab('read');
    window.addEventListener('hashchange', ()=>{ if (tabsEl.querySelector('.tab[aria-current="true"]').dataset.view==='read') openFromHash(); });
  })();
  </script>

  <!-- Inline JSON bundle (edit/replace with your generator output) -->
  <script id="SITE_DATA" type="application/json">
  {
    "book": { "title": "Advice Only‚Ñ¢ Methodology (Preview)" },
    "chapters": [
      {
        "title": "My Perfect Plan",
        "los": [
          {
            "title": "1.1 ‚Äî What's The Perfect Plan?",
            "preview": "The individual holds the power to define what is the 'perfect' financial plan.",
            "snippets": [
              {
                "title": "Body",
                "body": "A rational, repeatable process helps maintain focus and control with realistic assumptions."
              },
              {
                "quote": "The Perfect Plan tends to be sustainable, repeatable, and client-led."
              },
              {
                "title": "In practice",
                "bullets": [
                  "Clarify objectives before tools.",
                  "Document assumptions in plain language.",
                  "Iterate as life changes."
                ]
              }
            ]
          },
          {
            "title": "1.2 ‚Äî Why Be Rational?",
            "preview": "Objectivity reduces friction and increases confidence in decisions.",
            "snippets": [
              {
                "title": "Why seek the objective truth?",
                "body": "We define objectivity as a process guided by knowledge to reach independent conclusions."
              },
              {
                "title": "How can I prioritize my lifestyle?",
                "body": "Use structured exercises to rank what matters and make tradeoffs explicit."
              }
            ]
          },
          {
            "title": "1.3 ‚Äî Me, Myself and I",
            "preview": "Planning is about you‚Äîthe individual‚Äîfirst.",
            "snippets": [
              { "body": "Your values inform constraints and choices; the plan reflects that, not the other way around." }
            ]
          }
        ]
      },
      {
        "title": "Expenses",
        "los": [
          {
            "title": "2.1 ‚Äî Being Real",
            "preview": "Ground the plan in transparent, realistic cash needs.",
            "snippets": [
              { "body": "Start with fixed, then flex. Identify seasonal spikes. Separate needs vs. wants." }
            ]
          },
          {
            "title": "2.2 ‚Äî My Expenses",
            "preview": "A simple categorization model keeps the process durable.",
            "snippets": [
              { "bullets": ["Housing & utilities","Food & health","Transport","Savings & giving","Fun & misc."] }
            ]
          },
          {
            "title": "2.3 ‚Äî Understanding Inflation",
            "preview": "Inflation is uneven; tag categories with different long-run assumptions.",
            "snippets": [
              { "body": "Differentiate essentials from discretionary for stress testing." }
            ]
          }
        ]
      },
      {
        "title": "Cash Flow & Net Worth",
        "locked": true,
        "los": [
          {
            "title": "3.1 ‚Äî Key Planning Documents",
            "preview": "Available in the full version.",
            "snippets": []
          },
          {
            "title": "3.2 ‚Äî Learning Objective: Positive Cash Flow",
            "preview": "Available in the full version.",
            "snippets": []
          },
          {
            "title": "3.3 ‚Äî Compounding Interest",
            "preview": "Available in the full version.",
            "snippets": []
          }
        ]
      }
    ]
  }
  </script>

  <!-- Optional: Debug overlay for quick diagnostics -->
  <script>
  (() => {
    if (window.__SITE_DEBUG_INIT__) return;
    window.__SITE_DEBUG_INIT__ = true;
    const box = document.createElement('div');
    box.style.cssText='position:fixed;left:20px;top:20px;z-index:99999;max-width:680px;min-width:360px;background:#0e141c;color:#e8eef3;border:1px solid #374458;border-radius:12px;box-shadow:0 12px 28px rgba(0,0,0,.45);display:none';
    box.innerHTML = `
      <div style="display:flex;gap:10px;align-items:center;padding:10px 12px;border-bottom:1px solid #263140">
        <div style="font-weight:700">Inline JSON debug</div>
        <span id="sd_badge" style="margin-left:auto;padding:2px 8px;border-radius:999px;background:#2a3a4d;color:#cfe0ee">ok</span>
        <button id="sd_close" style="all:unset;cursor:pointer;color:#9fb3c6">‚úï</button>
      </div>
      <pre id="sd_detail" style="white-space:pre-wrap;margin:0;padding:12px;max-height:48vh;overflow:auto"></pre>
      <div style="display:flex;gap:8px;padding:10px 12px;border-top:1px solid #263140">
        <button id="sd_copy" style="all:unset;cursor:pointer;background:#1a2430;color:#cfe0ee;border:1px solid #2b3b4f;border-radius:8px;padding:6px 10px">Copy</button>
        <button id="sd_hide" style="all:unset;cursor:pointer;background:#1a2430;color:#cfe0ee;border:1px solid #2b3b4f;border-radius:8px;padding:6px 10px">Hide</button>
      </div>`;
    document.body.appendChild(box);
    const badge = box.querySelector('#sd_badge');
    const detail = box.querySelector('#sd_detail');
    box.querySelector('#sd_close').onclick = ()=>box.remove();
    box.querySelector('#sd_hide').onclick = ()=>box.style.display='none';
    box.querySelector('#sd_copy').onclick = async ()=>{ try{ await navigator.clipboard.writeText(detail.textContent); badge.textContent='copied'; } catch{ badge.textContent='copy failed'; } setTimeout(()=>badge.textContent='ok',800); };

    try{
      const raw = document.getElementById('SITE_DATA')?.textContent ?? '';
      const json = JSON.parse(raw);
      window.__SITE_DEBUG__ = { inlineBytes: raw.length, chapters: (json.chapters||[]).length, book: json.book?.title || '(no title)' };
      detail.textContent = `inline bytes: ${raw.length}\nbook: ${window.__SITE_DEBUG__.book}\nchapters: ${window.__SITE_DEBUG__.chapters}\n\nTip: replace the JSON block with your full export when ready.`;
    }catch(e){
      badge.textContent='error'; badge.style.background='#3b2930'; badge.style.color='#f7c0c7';
      detail.textContent = 'Inline JSON parse error: ' + e.message;
    }
    // Show briefly then hide; reopen in console: document.querySelectorAll('[id^=sd_]').length && (document.body.lastChild.style.display='block')
    box.style.display='block'; setTimeout(()=>box.style.display='none', 4000);
  })();
  </script>

</body>
</html>
