<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Advice Only™ — Book + Ask (Preview)</title>
<meta name="color-scheme" content="light dark">
<style>
  :root{
    --teal:#19ADBC; --dark:#14485C; --bg:#ffffff; --fg:#0f172a; --muted:#6b7280;
    --rail:#f8fafc; --border:#e5e7eb; --pill:#f3f4f6;
    --content:16px;
  }
  [data-theme="dark"]{
    --bg:#0b1220; --fg:#eef2ff; --muted:#9aa4b2; --rail:#0f172a; --border:#1f2937; --pill:#111827;
  }
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--fg);font:400 16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
  a{color:var(--teal);text-decoration:none} a:hover{text-decoration:underline}
  .wrap{display:grid;grid-template-columns:280px 8px 1fr 320px;min-height:100vh}
  /* LEFT NAV */
  .left{display:flex;flex-direction:column;border-right:1px solid var(--border);min-width:240px;max-width:380px}
  .brand{display:flex;gap:.6rem;align-items:center;padding:.8rem .9rem;border-bottom:1px solid var(--border)}
  .brand img{width:28px;height:28px;border-radius:6px}
  .brand .t1{font-weight:700}
  .tools{display:flex;gap:.5rem;margin-left:auto}
  .btn{border:1px solid var(--border);background:var(--pill);color:var(--fg);padding:.35rem .6rem;border-radius:.5rem;cursor:pointer}
  .btn.primary{border-color:var(--dark);background:var(--dark);color:#fff}
  .btn.small{font-size:.85rem;padding:.25rem .5rem}
  .nav-top{padding:.6rem .9rem;border-bottom:1px solid var(--border)}
  .dashboard-link{display:block;background:var(--pill);border:1px solid var(--border);padding:.5rem .7rem;border-radius:.5rem;font-weight:600;text-align:center}
  .chapters{overflow:auto;padding:.6rem .4rem .6rem .9rem}
  details.chapter{margin:.25rem 0;border-left:3px solid transparent}
  details.chapter[open]{border-left-color:var(--teal)}
  summary{list-style:none;cursor:pointer;font-weight:700}
  summary::-webkit-details-marker{display:none}
  .los{margin:.25rem 0 .5rem 0;padding-left:0}
  .los li{list-style:none;margin:.15rem 0}
  .los a{display:block;padding:.3rem .4rem;border-radius:.4rem}
  .los a.active{background:rgba(25,173,188,.12)}
  /* LEFT internal splitter */
  .nav-splitter{height:6px;background:var(--border);cursor:row-resize}
  .site{padding:.6rem .9rem;border-top:1px solid var(--border);background:var(--rail)}
  .site .acc{border:1px solid var(--border);border-radius:.6rem;overflow:hidden}
  .site .acc summary{padding:.6rem .7rem}
  .site .acc .panel{padding:.6rem .7rem;border-top:1px solid var(--border)}
  /* GUTTER */
  .gutter{background:var(--border);cursor:col-resize}
  /* MAIN */
  .main{padding:1rem 1.25rem}
  .topbar{display:flex;gap:.6rem;align-items:center;flex-wrap:wrap}
  .ask{flex:1;display:flex;border:1px solid var(--border);border-radius:.7rem;overflow:hidden}
  .ask input{flex:1;padding:.6rem .75rem;border:0;background:transparent;color:var(--fg)}
  .ask button{border-left:1px solid var(--border)}
  .readask{display:flex;gap:.4rem;margin-left:auto}
  .pill{border:1px solid var(--border);background:var(--pill);padding:.35rem .6rem;border-radius:999px;cursor:pointer}
  .pill[aria-selected="true"]{background:var(--dark);color:#fff;border-color:var(--dark)}
  .content{margin-top:1rem;display:grid;grid-template-rows:auto 1fr auto;gap:.6rem}
  h1{font-size:clamp(20px,2vw,28px);margin:.2rem 0 .5rem}
  h2{font-size:clamp(18px,1.6vw,22px);margin:.5rem 0 .4rem}
  .snippet{font-weight:700}
  .body{font-size:var(--content);line-height:1.65}
  .pager{display:flex;justify-content:space-between;gap:.6rem}
  .card{border:1px solid var(--border);border-radius:.6rem;padding:.7rem;background:transparent}
  .muted{color:var(--muted)}
  /* RIGHT RAIL */
  .right{border-left:1px solid var(--border);background:var(--rail);padding:1rem .9rem;min-width:260px}
  .right h3{margin:.2rem 0 .6rem}
  .event{border-top:1px dashed var(--border);padding:.5rem 0}
  /* font-size toggle (2 sizes) */
  .fs-large{--content:18.5px}
  /* mobile */
  @media (max-width: 980px){
    .wrap{grid-template-columns:1fr}
    .left,.gutter,.right{display:none}
    .main{padding:1rem}
  }
</style>
</head>
<body>
<div class="wrap">
  <!-- LEFT -->
  <aside class="left" id="left">
    <div class="brand">
      <img src="https://adviceonly.info/wp-content/uploads/2024/06/adviceonly_favicon.png" alt="Advice Only">
      <div class="t1">Advice Only™</div>
      <div class="tools">
        <button id="toggleTheme" class="btn small" title="Light/Dark">☾</button>
        <button id="toggleSize"  class="btn small" title="Text size">Aᴀ</button>
      </div>
    </div>
    <div class="nav-top">
      <a class="dashboard-link" href="#" id="navDashboard">Dashboard</a>
    </div>

    <!-- Chapters scroller (height is user-adjustable with the splitter) -->
    <div class="chapters" id="chapters"></div>
    <div class="nav-splitter" id="navSplit"></div>

    <!-- Site section (stays visible; not pushed off by chapters) -->
    <div class="site">
      <details class="acc" id="acc-events">
        <summary>Events</summary>
        <div class="panel" id="acc-events-panel"><em class="muted">Loading…</em></div>
      </details>
      <details class="acc" id="acc-office" style="margin-top:.6rem">
        <summary>Corte Madera Office</summary>
        <div class="panel">
          <div class="muted">Advisor: Quincy Hall, CFP®</div>
          <div style="border:1px solid var(--border);border-radius:.6rem;overflow:hidden;margin-top:.5rem">
            <iframe title="Map" width="100%" height="160" style="border:0" loading="lazy" allowfullscreen
                    referrerpolicy="no-referrer-when-downgrade"
                    src="https://www.google.com/maps?q=Corte%20Madera%2C%20CA&output=embed"></iframe>
          </div>
          <div style="margin-top:.6rem;display:flex;gap:.5rem;flex-wrap:wrap">
            <a class="btn" href="https://adviceonly.info/contact-us" target="_blank" rel="noopener">Contact</a>
            <a class="btn" href="https://www.linkedin.com/in/quincyhall/" target="_blank" rel="noopener">LinkedIn</a>
            <a class="btn" href="https://www.youtube.com/@adviceonly" target="_blank" rel="noopener">YouTube</a>
            <a class="btn" href="https://www.instagram.com/adviceonlyadvisor" target="_blank" rel="noopener">Instagram</a>
          </div>
        </div>
      </details>
    </div>
  </aside>

  <!-- GUTTER -->
  <div class="gutter" id="gutter"></div>

  <!-- MAIN -->
  <main class="main">
    <div class="topbar">
      <div class="ask">
        <input id="askQ" type="search" placeholder="Ask the methodology…" autocomplete="off">
        <button id="askGo" class="btn">Search</button>
      </div>
      <div class="readask">
        <button id="pillRead" class="pill" aria-selected="true">Read</button>
        <button id="pillAsk"  class="pill" aria-selected="false">Ask</button>
      </div>
    </div>

    <section class="content">
      <header><h1 id="title">Loading…</h1></header>
      <article id="article" class="card body">
        <p class="snippet" id="snippet"></p>
        <div id="body"></div>
      </article>
      <nav class="pager">
        <button id="prev" class="btn">← Prev</button>
        <button id="next" class="btn">Next →</button>
      </nav>
    </section>
  </main>

  <!-- RIGHT -->
  <aside class="right">
    <h3>Alerts</h3>
    <div class="card" id="alerts">
      <strong>Site Accessibility Tutorial</strong>
      <p class="muted">Use the left slider to resize the chapters list. Try dark mode ☾ and the Aᴀ text toggle.</p>
    </div>
    <h3 style="margin-top:1rem">Events</h3>
    <div class="card" id="eventsRail"><em class="muted">Loading…</em></div>
  </aside>
</div>

<script>
(async function(){
  /* ---------- helpers ---------- */
  const $ = sel => document.querySelector(sel);
  const el = (tag, attrs={}, children=[]) => {
    const x = document.createElement(tag);
    for(const [k,v] of Object.entries(attrs)){
      if(k==='class') x.className=v;
      else if(k==='html') x.innerHTML=v;
      else x.setAttribute(k,v);
    }
    (Array.isArray(children)?children:[children]).filter(Boolean).forEach(c=>x.appendChild(c));
    return x;
  };
  const store = {
    get(k, d){ try{return JSON.parse(localStorage.getItem(k)??'null') ?? d}catch{return d} },
    set(k,v){ localStorage.setItem(k, JSON.stringify(v)) }
  };

  /* ---------- theme & font-size ---------- */
  (function restorePrefs(){
    const theme = store.get('ao.theme','light');
    document.documentElement.setAttribute('data-theme', theme);
    if (store.get('ao.fs','normal')==='large') document.body.classList.add('fs-large');
  })();
  $('#toggleTheme').onclick = ()=>{
    const cur = document.documentElement.getAttribute('data-theme') || 'light';
    const nxt = cur==='dark'?'light':'dark';
    document.documentElement.setAttribute('data-theme', nxt);
    store.set('ao.theme', nxt);
  };
  $('#toggleSize').onclick = ()=>{
    const big = document.body.classList.toggle('fs-large');
    store.set('ao.fs', big?'large':'normal');
  };

  /* ---------- fetch site.json safely ---------- */
  const SITE_URL = new URL('site.json', window.location.href);
  let site;
  try{
    const r = await fetch(SITE_URL, { cache: 'no-store' });
    if(!r.ok) throw new Error(`HTTP ${r.status}`);
    site = await r.json();
  }catch(e){
    const pre = el('pre',{html:`Could not load site.json at ${SITE_URL} → ${e.message}
Tip: Start a local server in this folder:
  python3 -m http.server 5500  (then open http://127.0.0.1:5500/)
Files required: index.html and site.json`});
    pre.style.color='#c00'; document.body.prepend(pre); return;
  }

  /* ---------- build left chapters ---------- */
  const chaptersDiv = $('#chapters');
  const chFlat = []; // array of all LOs with chapter refs
  site.chapters.sort((a,b)=> (a.weight??0)-(b.weight??0)).forEach(ch=>{
    const d = el('details',{class:'chapter', open: ch.open ?? false});
    const sum = el('summary',{html: ch.title});
    const ul = el('ul',{class:'los'});
    (ch.los||[]).sort((a,b)=> (a.weight??0)-(b.weight??0)).forEach(lo=>{
      const aTag = el('a',{href:'#', html: lo.title});
      const li = el('li',{}, aTag);
      aTag.onclick = (evt)=>{evt.preventDefault(); select(ch.id, lo.id);};
      ul.appendChild(li);
      chFlat.push({ch, lo, aTag});
    });
    d.appendChild(sum); d.appendChild(ul); chaptersDiv.appendChild(d);
  });

  /* ---------- internal left splitter (chapters vs site) ---------- */
  const split = $('#navSplit'), left = $('#left');
  const topH = store.get('ao.navTopH', 260);
  $('#chapters').style.maxHeight = topH+'px';
  split.onmousedown = (e)=>{
    const startY = e.clientY; const startH = $('#chapters').offsetHeight;
    const move = (ev)=>{ const dy = ev.clientY - startY; const nh = Math.max(120, startH + dy);
      $('#chapters').style.maxHeight = nh+'px';
    };
    const up = ()=>{ store.set('ao.navTopH', parseInt($('#chapters').style.maxHeight)); window.removeEventListener('mousemove',move); window.removeEventListener('mouseup',up); };
    window.addEventListener('mousemove',move); window.addEventListener('mouseup',up);
  };

  /* ---------- center gutter (left width) ---------- */
  const gutter = $('#gutter');
  gutter.onmousedown = (e)=>{
    const wrap = document.querySelector('.wrap');
    const startX = e.clientX;
    const startW = left.offsetWidth;
    const move = (ev)=>{ const dx = ev.clientX - startX; const nw = Math.min(380, Math.max(220, startW + dx));
      wrap.style.gridTemplateColumns = nw+'px 8px 1fr 320px';
    };
    const up = ()=>{ window.removeEventListener('mousemove',move); window.removeEventListener('mouseup',up); };
    window.addEventListener('mousemove',move); window.addEventListener('mouseup',up);
  };

  /* ---------- render selection ---------- */
  let curIdx = 0; // index in chFlat
  function findIndex(chId, loId){
    return chFlat.findIndex(x=>x.ch.id===chId && x.lo.id===loId);
  }
  function select(chId, loId){
    const idx = findIndex(chId, loId);
    if(idx<0) return;
    curIdx = idx;
    const { ch, lo } = chFlat[idx];
    // activate in nav
    chFlat.forEach(x=>x.aTag.classList.remove('active'));
    chFlat[idx].aTag.classList.add('active');
    // open the chapter
    [...document.querySelectorAll('details.chapter')].forEach(d=>{
      if(d.querySelector('summary').textContent===ch.title) d.open=true;
    });
    // render
    $('#title').textContent = `${ch.title} — ${lo.title}`;
    $('#snippet').textContent = lo.snippet || '';
    const body = $('#body'); body.innerHTML='';
    (lo.body || []).forEach(p=>{
      const elp = document.createElement('p'); elp.textContent = p; body.appendChild(elp);
    });
    // images (optional)
    if(Array.isArray(lo.images)){
      lo.images.forEach(src=>{
        const fig = document.createElement('figure');
        const img = document.createElement('img');
        img.src = src; img.alt = ''; img.style.maxWidth='100%'; img.style.borderRadius='.5rem';
        fig.appendChild(img); body.appendChild(fig);
      });
    }
  }

  function step(dir){
    const n = curIdx + dir;
    if(n>=0 && n<chFlat.length){
      select(chFlat[n].ch.id, chFlat[n].lo.id);
      // scroll active into view within chapters scroller
      chFlat[n].aTag.scrollIntoView({block:'nearest'});
    }
  }
  $('#prev').onclick = ()=>step(-1);
  $('#next').onclick = ()=>step(1);

  /* ---------- Ask pills (visual only for now) ---------- */
  const pillRead = $('#pillRead'), pillAsk = $('#pillAsk');
  function setMode(which){
    pillRead.setAttribute('aria-selected', which==='read');
    pillAsk.setAttribute('aria-selected', which==='ask');
    // For now, just focus input when switching to Ask
    if(which==='ask') $('#askQ').focus();
  }
  pillRead.onclick = ()=>setMode('read');
  pillAsk.onclick  = ()=>setMode('ask');

  /* ---------- Ask search (suggests by LO snippets) ---------- */
  const allSnips = chFlat.map(x=>({title:x.lo.title, snippet:x.lo.snippet||'', ref:x}));
  $('#askGo').onclick = ()=>{
    const q = ($('#askQ').value||'').trim().toLowerCase();
    if(!q) return;
    const scored = allSnips.map(s=>{
      const text = (s.title+' '+s.snippet).toLowerCase();
      const score = text.includes(q) ? 2 : (q.split(/\s+/).some(w=>text.includes(w))?1:0);
      return {score, s};
    }).filter(r=>r.score>0).sort((a,b)=>b.score-a.score).slice(0,6);
    // show them as minimal list in the article body (non-destructive)
    const body = $('#body'); const div = document.createElement('div');
    div.className='card'; div.style.marginTop='.8rem';
    div.innerHTML = `<div class="muted" style="margin-bottom:.4rem">Matches:</div>` +
      scored.map(r=>`<div class="event"><a href="#" data-ch="${r.s.ref.ch.id}" data-lo="${r.s.ref.lo.id}">${r.s.ref.lo.title}</a><div class="muted">${r.s.snippet||''}</div></div>`).join('');
    body.prepend(div);
    div.querySelectorAll('a[data-ch]').forEach(a=>{
      a.onclick = (ev)=>{ev.preventDefault(); select(a.dataset.ch, a.dataset.lo);}
    });
  };

  /* ---------- Events (left accordion + right rail) ---------- */
  function renderEvents(list){
    const html = list.map(ev=>`<div class="event">
      <strong>${ev.title}</strong><div class="muted">${ev.when} • ${ev.where}</div>
      <div style="margin-top:.35rem"><a class="btn" href="${ev.link}" target="_blank" rel="noopener">Register</a></div>
    </div>`).join('');
    $('#acc-events-panel').innerHTML = html || '<em class="muted">No upcoming events.</em>';
    $('#eventsRail').innerHTML = html || '<em class="muted">No upcoming events.</em>';
  }

  /* ---------- Boot: select first LO, fill events ---------- */
  if(chFlat.length){ select(chFlat[0].ch.id, chFlat[0].lo.id); }
  renderEvents(site.events || []);

  /* ---------- Dashboard placeholder ---------- */
  $('#navDashboard').onclick = (e)=>{
    e.preventDefault();
    $('#title').textContent = 'Dashboard (My Data)';
    $('#snippet').textContent = '';
    $('#body').innerHTML = `
      <div class="card">
        <strong>Exposure badges (demo)</strong>
        <p class="muted">In V1 this would summarize time-on-page; V2 adds scores & exports.</p>
      </div>
    `;
  };
})();
</script>
</body>
</html>
